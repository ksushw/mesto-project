(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{u0:()=>M,N_:()=>D,xS:()=>P});var t={baseUrl:"https://nomoreparties.co/v1/plus-cohort-21",headers:{authorization:"6fc36c5b-30c6-4228-accb-664772d22e4e","Content-Type":"application/json"}},o=function(e){e.classList.add("popup_opened")},n={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button-save",inactiveButtonClass:"button_inactive",inputErrorClass:".form__input-error",errorClass:".form__input-error_active"},r=function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));n.textContent="",n.classList.remove(o.errorClass),t.classList.remove(o.inputErrorClass)},c=function(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.removeAttribute("disabled"),t.classList.remove(o)):(t.setAttribute("disabled",!0),t.classList.add(o))},a=function(e){var t=e.querySelector(".form__button-save");t.setAttribute("disabled",!0),t.classList.add("button_inactive")},u=document.querySelector(".popup_type_edit"),i=document.querySelectorAll(".popup__button-close"),s=document.querySelector(".profile__name"),l=document.querySelector(".profile__description"),d=document.querySelector(".form__input_name"),f=document.querySelector(".form__input_job"),m=document.querySelector(".form__input_avatar"),p=function(){d.value=s.textContent,f.value=l.textContent},_=function(e){if(27===e.keyCode&&o){var t=document.querySelector(".popup_opened");h(t)}},v=function(e){o(e);var t=e.querySelector(".popup__overlay");document.addEventListener("keyup",_),t.addEventListener("click",y)};function y(){var e=document.querySelector(".popup_opened");h(e)}var h=function(e){var t=document.querySelector(".popup_opened").querySelector(".popup__overlay");document.removeEventListener("keyup",_),t.removeEventListener("click",y),function(e){e.classList.remove("popup_opened")}(e)},S=function(e){var t=e.querySelector(".form__button-save");t.setAttribute("disabled",!0),t.textContent="Сохранение..."},b=document.querySelector(".popup_type_add"),q=document.querySelector(".popup__image"),k=document.querySelector(".popup__capture"),C=document.querySelector(".popup_type_img"),E=document.querySelector(".form__input_place"),L=document.querySelector(".form__input_url"),g=function(e,t,o){var n=document.querySelector(".places"),r=function(e,t,o){var n=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),r=n.querySelector(".card__button-like"),c=n.querySelector(".card__trash-can"),a=n.querySelector(".card__amount-likes"),u=n.querySelector(".card__photo"),i=n.querySelector(".card__name");return o.owner._id!==P&&c.remove(),u.src=t,u.alt=e,i.textContent=e,o.likes.length&&(a.textContent=o.likes.length,o.likes.forEach((function(e){e._id===P&&r.classList.add("card__button-like_active")}))),j(r,o._id,n,a),x(c,o._id),A(t,e,u),n}(e,t,o);n.prepend(r)},j=function(e,o,n,r){e.addEventListener("click",(function(c){n.querySelector(".card__button-like_active")?function(e,o,n){var r;e.classList.remove("card__button-like_active"),n.textContent=Number(n.textContent)-1,r=o,fetch("".concat(t.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e,o,r):function(e,o,n){var r;e.classList.add("card__button-like_active"),n.textContent=Number(n.textContent)+1,r=o,fetch("".concat(t.baseUrl,"/cards/likes/").concat(r),{method:"PUT",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e,o,r)}))},x=function(e,o){e.addEventListener("click",(function(){var n,r=e.closest(".card");n=o,fetch("".concat(t.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),r.remove()}))},A=function(e,t,o){o.addEventListener("click",(function(){q.src=e,q.alt=t,k.textContent=t,v(C)}))},P="",U=document.querySelector(".profile__edit"),N=document.forms["edit-profile"],O=document.querySelector(".profile__add"),T=document.forms["add-picture"],B=document.querySelector(".profile__photo-img"),D=document.querySelector(".popup_type_avatar-edit"),J=document.forms["edit-profile-img"],M=document.querySelector(".profile__photo");fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){s.textContent=e.name,l.textContent=e.about,B.src=e.avatar,P=e._id})).catch((function(e){console.log(e)})),fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){!function(e){e=e.reverse();for(var t=0;t<e.length;t++)g(e[t].name,e[t].link,e[t])}(Array.from(e))})).catch((function(e){console.log(e)})),M.addEventListener("click",(function(){v(D),a(D)})),J.addEventListener("submit",(function(e){var o;S(D),e.preventDefault(),(o=m.value,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){M.src=e.avatar,h(D)})).catch((function(e){console.log(e)}))})),U.addEventListener("click",(function(){v(u),a(u),Array.from(u.querySelectorAll(".form__input")).forEach((function(e){r(u,e,n)})),p()})),N.addEventListener("submit",(function(e){var o,n;S(u),e.preventDefault(),(o=d.value,n=f.value,fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:o,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){s.textContent=e.name,l.textContent=e.about,h(u)})).catch((function(e){console.log(e)}))})),O.addEventListener("click",(function(){v(b),a(b)})),T.addEventListener("submit",(function(e){var o,n;e.preventDefault(e),S(b),(o=E.value,n=L.value,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:o,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(t){g(t.name,t.link,t),e.target.reset(),console.log(t),h(b)})).catch((function(e){console.log(e)}))})),p(),i.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){h(t)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);c(o,n,t.inactiveButtonClass),o.forEach((function(a){a.addEventListener("input",(function(){!function(e,t,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?r(e,t,o):function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=o,r.classList.add(n.errorClass),t.classList.add(n.inputErrorClass)}(e,t,t.validationMessage,o)}(e,a,t),c(o,n,t.inactiveButtonClass)}))}))}(t,e)}))}(n)})();